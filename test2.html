<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cluster Gravity - Final Melting</title>
    <style>
        body {
            background-color: #e0e0e0;
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .cluster-container {
            position: absolute;
            width: 220px; 
            height: 220px;
            transform: translate(-50%, -50%);
            z-index: 1000;
            cursor: pointer; 
        }

        .cluster-obj {
            position: absolute;
            transition: none !important; 
            pointer-events: none; 
            user-select: none;
            
            /* Visual Polish */
            object-fit: contain; 
            filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.2)); /* Deep shadow */
            
            /* Start with a slight rotation so they look tumbled */
            transform: translate(-50%, -50%) rotate(0deg);
        }
    </style>
</head>
<body>

    <div style="position: absolute; top: 10px; left: 10px; font-family: sans-serif; font-size: 12px; color: #888;">
        <strong>System Active: "Melting"</strong><br>
        Physics: Gravity Cascade (No initial push)<br>
        Scale: Tight Banding (130px - 160px)
    </div>

    <script>
        window.addEventListener('load', function() {
            
            // --- 1. YOUR OBJECT LIST ---
            // These match the filenames we just generated.
            // Ensure your actual image files match these exactly.
            const fileList = [
                // CLOTHING
                'heavy-jacket_XHS.png',
                'fur-vest_LNM.png',
                'jeans_LHM.png',
                'waffle-shirt_LNM.png',
                'brown-waffle_LNM.png',
                'white-shirt_LNM.png',
                'polo-shirt_MNM.png',
                'tshirt_MNM.png',
                'shorts_MNM.png',
                'wool-hat_SLM.png',
                'slippers_MLM.png',
                'belt_SNS.png',

                // OBJECTS
                'basketball_LNM.png',
                'dust-buster_LHS.png',
                'hand-mixer_MHS.png',
                'radio_MHS.png',
                'colander_LNM.png',
                'baseball-mitt_LHS.png',
                'headphones_MNM.png',
                'book_MNS.png',
                'drink-shaker_MHS.png',
                'outlet-extender_SHS.png',
                'frisbee_MLF.png'
            ];

            // --- 2. DEFINITIONS (The "Tight Banding" Scale) ---
            const DICT = {
                // SIZES: Very close together for cohesion
                'S': 130,   
                'M': 140,  
                'L': 150, 
                'X': 160,  
                
                // WEIGHTS (Gravity & Drag)
                'L': { grav: 0.20, drag: 0.96 }, // Floatier
                'N': { grav: 0.50, drag: 0.98 }, // Standard
                'H': { grav: 1.20, drag: 0.99 }, // Heavy (Falls fast)

                // ROTATION (Torque)
                'S': 1.5, // Stable
                'M': 4,   // Tumble
                'F': 10   // Spin
            };

            const FALLBACK = { size: 140, grav: 0.5, drag: 0.98, torque: 3 };

            // --- 3. PARSER ---
            function decodeFilename(filename) {
                let raw = filename.split('.')[0]; 
                let parts = raw.split('_');
                if(parts.length < 2) return FALLBACK;
                let code = parts[parts.length - 1].toUpperCase();
                if (code.length !== 3) return FALLBACK;

                return {
                    sizePx: DICT[code[0]] || FALLBACK.size,
                    physics: DICT[code[1]] || { grav: FALLBACK.grav, drag: FALLBACK.drag },
                    rotSpeed: DICT[code[2]] || FALLBACK.torque
                };
            }

            // --- 4. ENGINE ---
            let zIndex = 1000;

            function createCluster() {
                var container = document.createElement('div');
                container.className = 'cluster-container';
                
                var spawnX = Math.random() * (window.innerWidth - 300) + 150;
                var spawnY = Math.random() * (window.innerHeight * 0.5) + 150;
                
                container.style.left = spawnX + 'px';
                container.style.top = spawnY + 'px';
                container.style.zIndex = zIndex++;
                
                var count = Math.floor(Math.random() * 4) + 3; // 3 to 6 items per cluster

                container.particles = [];

                for(var i=0; i<count; i++) {
                    if(fileList.length === 0) break;
                    var filename = fileList[Math.floor(Math.random() * fileList.length)];
                    var dna = decodeFilename(filename);

                    // Create Image
                    var box = document.createElement('img'); 
                    box.src = filename; 
                    
                    // Fallback visual (Grey Circle) if image is missing
                    box.onerror = function() {
                        this.style.backgroundColor = '#ccc';
                        this.style.borderRadius = '50%';
                        this.style.border = '2px solid #888';
                    };

                    box.className = 'cluster-obj';
                    box.style.width = dna.sizePx + 'px';
                    box.style.height = dna.sizePx + 'px'; 

                    // Attach Physics
                    box.dataset.grav = dna.physics.grav;
                    box.dataset.drag = dna.physics.drag;
                    box.dataset.torque = dna.rotSpeed;

                    // Tight Scatter
                    var scatter = 60; 
                    var offsetX = (Math.random() - 0.5) * scatter + 110; 
                    var offsetY = (Math.random() - 0.5) * scatter + 110;
                    
                    // Initial random rotation
                    var initialRot = (Math.random() - 0.5) * 60; 
                    box.dataset.currentRot = initialRot;

                    box.style.left = offsetX + 'px';
                    box.style.top = offsetY + 'px';
                    box.style.transform = `translate(-50%, -50%) rotate(${initialRot}deg)`;

                    container.appendChild(box);
                    container.particles.push(box);
                }

                container.onmouseenter = function() {
                    if(!container.exploding) {
                        container.exploding = true;
                        melt(container);
                        createCluster(); 
                    }
                };

                document.body.appendChild(container);
            }

            // --- 5. THE MELT ANIMATION ---
            function melt(container) {
                var children = container.particles;
                var activeParticles = children.length;
                var startAbsY = container.getBoundingClientRect().top;
                
                container.style.pointerEvents = 'none';

                children.forEach(function(box, index) {
                    
                    // The "Cascade" Delay (80ms per item)
                    setTimeout(function() {
                        
                        var pGrav = parseFloat(box.dataset.grav);
                        var pDrag = parseFloat(box.dataset.drag);
                        var pTorque = parseFloat(box.dataset.torque);

                        // START VELOCITY = 0 (Crucial for "melting" feel)
                        var vx = (Math.random() - 0.5) * 0.5; // Very slight drift
                        var vy = 0; 
                        
                        var x = 0;
                        var y = 0;
                        var r = parseFloat(box.dataset.currentRot);
                        var rs = (Math.random() < 0.5 ? -1 : 1) * (Math.random() * 0.2); 

                        function loop() {
                            vy += pGrav;     
                            vx *= pDrag;     
                            
                            // Spin increases as it falls
                            rs += (rs > 0 ? 0.05 : -0.05) * (pTorque * 0.08); 
                            
                            x += vx;
                            y += vy;
                            r += rs;

                            box.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px)) rotate(${r}deg)`;

                            // Kill boundary
                            if ((startAbsY + y) < window.innerHeight + 400) {
                                requestAnimationFrame(loop);
                            } else {
                                box.remove();
                                activeParticles--;
                                if (activeParticles === 0) container.remove();
                            }
                        }
                        requestAnimationFrame(loop);

                    }, index * 80); 
                });
            }

            createCluster();
        });
    </script>
</body>
</html>